/*
Name: Simple Wysiwym Editor for jQuery
By: Michael Shepanski
Web Site: (http://pushingkarma.com/)
Project Page: (http://pushingkarma.com/projects/jquery-wysiwym/)
Licence: Licensed via Creative Commons Attribution (http://creativecommons.org/licenses/by/3.0/)
Version: 2.0
*/

var BLANKLINE="";var Wysiwym={};$.fn.wysiwym=function(b,a){this.EDITORCLASS="wysiwym-editor";this.BUTTONCLASS="wysiwym-buttons";this.HELPCLASS="wysiwym-help";this.HELPTOGGLECLASS="wysiwym-help-toggle";this.textelem=this;this.textarea=$(this);this.editor=undefined;this.markup=new b(this);this.defaults={containerButtons:undefined,containerHelp:undefined,helpEnabled:false,helpToggle:false,helpToggleElem:undefined,helpTextShow:"show markup syntax",helpTextHide:"hide markup syntax"};this.options=$.extend(this.defaults,a?a:{});this.initializeButtons=function(){var c=this.markup;if(this.options.containerButtons==undefined){this.options.containerButtons=$("<div></div>").insertBefore(this.textarea)}this.options.containerButtons.addClass(this.BUTTONCLASS);for(var e=0;e<c.buttons.length;e++){var d=c.buttons[e];var g=d.create();if(e==0){g.addClass("first")}if(e==c.buttons.length-1){g.addClass("last")}var f=$.extend({markup:this.markup},d.data);g.bind("click",f,d.callback);this.options.containerButtons.append(g)}};this.initializeAutoIndent=function(){if(this.markup.autoindents){var c={markup:this.markup};this.textarea.bind("keydown",c,Wysiwym.autoIndent)}};this.initializeHelp=function(){if(this.options.helpEnabled){if(this.options.containerHelp==undefined){this.options.containerHelp=$("<div></div>").insertAfter(this.textarea)}this.options.containerHelp.addClass(this.HELPCLASS);var e=$("<tbody></tbody>");var f=$('<table cellpadding="0" cellspacing="0" border="0"></table>').append(e);for(var c=0;c<this.markup.help.length;c++){var d=this.markup.help[c];e.append("<tr><th>"+d.label+"</th><td>"+d.syntax+"</td></tr>")}this.options.containerHelp.append(f)}};this.initializeHelpToggle=function(){if(this.options.helpToggle&&this.options.helpEnabled){var c=this;if(this.options.helpToggleElem==undefined){this.options.helpToggleElem=$("<a href='#'>"+this.options.helpTextShow+"</a>")}this.options.helpToggleElem.addClass(this.HELPTOGGLECLASS);this.options.helpToggleElem.bind("click",function(){if(c.options.containerHelp.is(":visible")){c.options.containerHelp.slideUp("fast");$(this).text(c.options.helpTextShow)}else{c.options.containerHelp.slideDown("fast");$(this).text(c.options.helpTextHide)}return false});this.options.containerHelp.before(this.options.helpToggleElem).hide()}};this.editor=$('<div class="'+this.EDITORCLASS+'"></div>');this.textarea.wrap(this.editor);this.initializeButtons();this.initializeAutoIndent();this.initializeHelp();this.initializeHelpToggle()};Wysiwym.Selection=function(a){this.lines=a.lines;this.start={line:0,position:0},this.end={line:0,position:0},this.toString=function(){var b="SELECTION: "+this.length()+" chars\n";b+="START LINE: "+this.start.line+"; POSITION: "+this.start.position+"\n";b+="END LINE: "+this.end.line+"; POSITION: "+this.end.position+"\n";return b};this.addLinePrefixes=function(c){for(var b=this.start.line;b<=this.end.line;b++){this.lines[b]=c+this.lines[b]}this.start.position+=c.length;this.end.position+=c.length};this.addPrefix=function(e){var g=this.lines.length;var b=this.lines[this.start.line];var c=b.substring(0,this.start.position)+e+b.substring(this.start.position,b.length);this.lines[this.start.line]=c;this.start.position+=e.length;if(this.start.line==this.end.line){this.end.position+=e.length}if(e.indexOf("\n")!=-1){var d=a.textelem.scrollHeight;var f=parseInt(d/g);a.scroll+=f}};this.addSuffix=function(d){var b=this.lines[this.end.line];var c=b.substring(0,this.end.position)+d+b.substring(this.end.position,b.length);this.lines[this.end.line]=c};this.append=function(d){var b=this.lines[this.end.line];var c=b.substring(0,this.end.position)+d+b.substring(this.end.position,b.length);this.lines[this.end.line]=c;this.end.position+=d.length};this.getLines=function(){var b=[];for(var c=this.start.line;c<=this.end.line;c++){b[b.length]=this.lines[c]}return b};this.hasPrefix=function(c){var b=this.lines[this.start.line];var d=this.start.position-c.length;if((d<0)||(b.substring(d,this.start.position)!=c)){return false}return true};this.hasSuffix=function(d){var c=this.lines[this.end.line];var b=this.end.position+d.length;if((b>c.length)||(c.substring(this.end.position,b)!=d)){return false}return true};this.insertPreviousLine=function(b,c){c=c!==undefined?c:true;var d=this.start.line-1;if((c)||((d>=0)&&(this.lines[d]!=b))){this.lines.splice(this.start.line,0,b);this.start.line+=1;this.end.line+=1}};this.insertNextLine=function(b,d){d=d!==undefined?d:true;var c=this.end.line+1;if((d)||((c<this.lines.length)&&(this.lines[c]!=b))){this.lines.splice(c,0,b)}};this.isWrapped=function(b,c){return((this.hasPrefix(b))&&(this.hasSuffix(c)))};this.length=function(){return this.val().length};this.linesHavePrefix=function(d){for(var c=this.start.line;c<=this.end.line;c++){var b=this.lines[c];if((typeof(d)=="string")&&(!b.startswith(d))){return false}else{if((typeof(d)!="string")&&(!b.match(d))){return false}}}return true};this.prepend=function(d){var b=this.lines[this.start.line];var c=b.substring(0,this.start.position)+d+b.substring(this.start.position,b.length);this.lines[this.start.line]=c;if(this.start.line==this.end.line){this.end.position+=d.length}};this.removeLinePrefixes=function(e){for(var d=this.start.line;d<=this.end.line;d++){var b=this.lines[d];var c=e;if(typeof(e)!="string"){c=b.match(e)[0]}if(b.startswith(c)){this.lines[d]=b.substring(c.length,b.length);if(d==this.start.line){this.start.position-=c.length}if(d==this.end.line){this.end.position-=c.length}}}};this.removeNextLine=function(d){var b=this.end.line+1;var c=false;if((b<this.lines.length)&&(d)&&(this.lines[b].match(d))){c=true}if((b<this.lines.length)&&(!d)){c=true}if(c){this.lines.splice(b,1)}};this.removePrefix=function(d){if(this.hasPrefix(d)){var b=this.lines[this.start.line];var e=this.start.position-d.length;var c=b.substring(0,e)+b.substring(this.start.position,b.length);this.lines[this.start.line]=c;this.start.position-=d.length;if(this.start.line==this.end.line){this.end.position-=d.length}}};this.removePreviousLine=function(c){var d=this.start.line-1;var b=false;if((d>=0)&&(c)&&(this.lines[d].match(c))){b=true}if((d>=0)&&(!c)){b=true}if(b){this.lines.splice(d,1);this.start.line-=1;this.end.line-=1}};this.removeSuffix=function(e){if(this.hasSuffix(e)){var c=this.lines[this.end.line];var b=this.end.position+e.length;var d=c.substring(0,this.end.position)+c.substring(b,c.length);this.lines[this.end.line]=d}};this.setLinePrefixes=function(f,b){b=b?b:false;for(var e=this.start.line;e<=this.end.line;e++){if(!this.lines[e].startswith(f)){if(b){var d=parseInt(f.match(/\d+/)[0]);f=f.replace(d,d+1)}var c=this.lines[e].match(/^\s*/)[0].length;this.lines[e]=this.lines[e].lstrip();this.lines[e]=f+this.lines[e];if(e==this.start.line){this.start.position+=f.length-c}if(e==this.end.line){this.end.position+=f.length-c}}}};this.unwrap=function(b,c){this.removePrefix(b);this.removeSuffix(c)};this.unwrapBlankLines=function(){a.selection.removePreviousLine(/^\s*$/);a.selection.removeNextLine(/^\s*$/)};this.val=function(){var d="";for(var c=0;c<this.lines.length;c++){var b=this.lines[c];if((c==this.start.line)&&(c==this.end.line)){return b.substring(this.start.position,this.end.position)}else{if(c==this.start.line){d+=b.substring(this.start.position,b.length)+"\n"}else{if((c>this.start.line)&&(c<this.end.line)){d+=b+"\n"}else{if(c==this.end.line){d+=b.substring(0,this.end.position)}}}}}return d};this.wrap=function(b,c){this.addPrefix(b);this.addSuffix(c)};this.wrapBlankLines=function(){if(a.selection.start.line>0){a.selection.insertPreviousLine(BLANKLINE,false)}if(a.selection.end.line<a.lines.length-1){a.selection.insertNextLine(BLANKLINE,false)}}};Wysiwym.Textarea=function(a){this.textelem=a.get(0);this.textarea=a;this.lines=[];this.selection=new Wysiwym.Selection(this);this.scroll=this.textelem.scrollTop;this.toString=function(){var c="TEXTAREA: #"+this.textarea.attr("id")+"\n";c+=this.selection.toString();c+="SCROLL: "+this.scroll+"px\n";c+="---\n";for(var b=0;b<this.lines.length;b++){c+="LINE "+b+": "+this.lines[b]+"\n"}return c};this.getProperties=function(){var e="";var c=0;var d=0;for(var b=0;b<this.lines.length;b++){if(b==this.selection.start.line){c=e.length+this.selection.start.position}if(b==this.selection.end.line){d=e.length+this.selection.end.position}e+=this.lines[b];if(b!=this.lines.length-1){e+="\n"}}return[e,c,d]};this.getSelectionStartEnd=function(){if(typeof(this.textelem.selectionStart)=="number"){var g=this.textelem.selectionStart;var f=this.textelem.selectionEnd}else{this.textelem.focus();var h=this.textelem.value.replace(/\r\n/g,"\n");var e=h.length;var d=document.selection.createRange();var c=this.textelem.createTextRange();c.moveToBookmark(d.getBookmark());var b=this.textelem.createTextRange();b.collapse(false);if(c.compareEndPoints("StartToEnd",b)>-1){var g=e;var f=e}else{var g=-c.moveStart("character",-e);if(c.compareEndPoints("EndToEnd",b)>-1){var f=e}else{var f=-c.moveEnd("character",-e)}}}return[g,f]};this.update=function(){var c=this.getProperties();var f=c[0];var d=c[1];var e=c[2];this.textarea.val(f);if(this.textelem.setSelectionRange){this.textelem.setSelectionRange(d,e)}else{if(this.textelem.createTextRange){var b=this.textelem.createTextRange();b.collapse(true);b.moveStart("character",d);b.moveEnd("character",e-d);b.select()}}console.log("Set scroll: "+this.scroll);this.textelem.scrollTop=this.scroll;this.textarea.focus()};this.init=function(){var g=a.val().replace(/\r\n/g,"\n");var e=this.getSelectionStartEnd(this.textelem);var c=e[0];var d=e[1];var f=0;while(f>=0){var f=g.indexOf("\n");var b=g.substring(0,f>=0?f:g.length);if((c<=b.length)&&(d>=0)){if(c>=0){this.selection.start.line=this.lines.length;this.selection.start.position=c}if(d<=b.length){this.selection.end.line=this.lines.length;this.selection.end.position=d}}this.lines[this.lines.length]=b;g=f>=0?g.substring(f+1,g.length):"";c-=f+1;d-=f+1}if((this.selection.end.position==0)&&(this.selection.end.line!=this.selection.start.line)){this.selection.end.line-=1;this.selection.end.position=this.lines[this.selection.end.line].length}};this.init()};Wysiwym.Button=function(a,d,c,b){this.name=a;this.callback=d;this.data=c?c:{};this.cssclass=b;this.getCssClass=function(){if(!this.cssclass){return this.name.toLowerCase().replace(" ","")}return this.cssclass};this.create=function(){var g=$('<span class="text">'+this.name+"</span>");var f=$('<span class="wrap"></span>').append(g);var e=$('<div class="button"></div>').append(f);e.attr("title",this.name);e.addClass(this.getCssClass());g.attr("unselectable","on");f.attr("unselectable","on");e.attr("unselectable","on");return e}};Wysiwym.span=function(c){var a=c.data.markup;var d=c.data.prefix;var e=c.data.suffix;var f=c.data.text;var b=new Wysiwym.Textarea(a.textarea);if(b.selection.isWrapped(d,e)){b.selection.unwrap(d,e)}else{if(b.selection.length()==0){b.selection.append(f);b.selection.wrap(d,e)}else{b.selection.wrap(d,e)}}b.update()};Wysiwym.list=function(e){var a=e.data.markup;var f=e.data.prefix;var b=e.data.wrap;var d=e.data.regex;var c=new Wysiwym.Textarea(a.textarea);if(c.selection.linesHavePrefix(d?d:f)){c.selection.removeLinePrefixes(d?d:f);if(b){c.selection.unwrapBlankLines()}}else{c.selection.setLinePrefixes(f,d);if(b){c.selection.wrapBlankLines()}}c.update()};Wysiwym.block=function(e){var a=e.data.markup;var f=e.data.prefix;var b=e.data.wrap;var d=new Wysiwym.Textarea(a.textarea);var c=d.selection.getLines()[0];if(c.startswith(f)){d.selection.removeLinePrefixes(f);if(b){d.selection.unwrapBlankLines()}}else{d.selection.addLinePrefixes(f);if(b){d.selection.wrapBlankLines()}}d.update()};Wysiwym.autoIndent=function(a){if(a.keyCode!=13){return true}var l=a.data.markup;var c=new Wysiwym.Textarea(l.textarea);var g=c.selection.start.line;var m=c.lines[g];var b=m.substring(c.selection.start.position,m.length);if((c.selection.length()!=0)||(b)){return true}for(var d=0;d<l.autoindents.length;d++){var j=l.autoindents[d];var f=m.match(j);if(f){var h=f[0];var k=m.substring(h.length,m.length);if(f.length==2){var e=parseInt(f[1]);h=h.replace(f[1],e+1)}if(k){c.selection.addPrefix("\n"+h);c.update();return false}else{c.lines[g]=BLANKLINE;c.selection.start.position=0;c.selection.end.position=c.selection.start.position;if(l.exitindentblankline){c.selection.addPrefix("\n")}c.update();return false}}}return true};Wysiwym.Markdown=function(a){this.textarea=a;this.buttons=[new Wysiwym.Button("Bold",Wysiwym.span,{prefix:"**",suffix:"**",text:"strong text"}),new Wysiwym.Button("Italic",Wysiwym.span,{prefix:"_",suffix:"_",text:"italic text"}),new Wysiwym.Button("Link",Wysiwym.span,{prefix:"[",suffix:"](http://example.com)",text:"link text"}),new Wysiwym.Button("Bullet List",Wysiwym.list,{prefix:"* ",wrap:true}),new Wysiwym.Button("Number List",Wysiwym.list,{prefix:"0. ",wrap:true,regex:/^\s*\d+\.\s/}),new Wysiwym.Button("Quote",Wysiwym.list,{prefix:"> ",wrap:true}),new Wysiwym.Button("Code",Wysiwym.block,{prefix:"    ",wrap:true})];this.exitindentblankline=true;this.autoindents=[/^\s*\*\s/,/^\s*(\d+)\.\s/,/^\s*\>\s/,/^\s{4}\s*/];this.help=[{label:"Header",syntax:"## Header ##"},{label:"Bold",syntax:"**bold**"},{label:"Italic",syntax:"_italics_"},{label:"Link",syntax:"[pk!](http://google.com)"},{label:"Bullet List",syntax:"* list item"},{label:"Number List",syntax:"1. list item"},{label:"Blockquote",syntax:"&gt; quoted text"},{label:"Large Code Block",syntax:"(Begin lines with 4 spaces)"},{label:"Inline Code Block",syntax:"&lt;code&gt;inline code&lt;/code&gt;"}]};Wysiwym.Mediawiki=function(a){this.textarea=a;this.buttons=[new Wysiwym.Button("Bold",Wysiwym.span,{prefix:"'''",suffix:"'''",text:"strong text"}),new Wysiwym.Button("Italic",Wysiwym.span,{prefix:"''",suffix:"''",text:"italic text"}),new Wysiwym.Button("Link",Wysiwym.span,{prefix:"[http://example.com ",suffix:"]",text:"link text"}),new Wysiwym.Button("Bullet List",Wysiwym.list,{prefix:"* ",wrap:true}),new Wysiwym.Button("Number List",Wysiwym.list,{prefix:"# ",wrap:true}),new Wysiwym.Button("Quote",Wysiwym.span,{prefix:"<blockquote>",suffix:"</blockquote>",text:"quote text"}),new Wysiwym.Button("Code",Wysiwym.span,{prefix:"<pre>",suffix:"</pre>",text:"code text"})];this.exitindentblankline=true;this.autoindents=[/^\s*\*\s/,/^\s*\#\s/];this.help=[{label:"Header",syntax:"== Header =="},{label:"Bold",syntax:"'''bold'''"},{label:"Italic",syntax:"''italics''"},{label:"Link",syntax:"[http://google.com pk!]"},{label:"Bullet List",syntax:"* list item"},{label:"Number List",syntax:"# list item"},{label:"Blockquote",syntax:"&lt;blockquote&gt;quote&lt;/blockquote&gt;"},{label:"Large Code Block",syntax:"&lt;pre&gt;Code block&lt;/pre&gt;"}]};Wysiwym.BBCode=function(a){this.textarea=a;this.buttons=[new Wysiwym.Button("Bold",Wysiwym.span,{prefix:"[b]",suffix:"[/b]",text:"strong text"}),new Wysiwym.Button("Italic",Wysiwym.span,{prefix:"[i]",suffix:"[/i]",text:"italic text"}),new Wysiwym.Button("Link",Wysiwym.span,{prefix:'[url="http://example.com"]',suffix:"[/url]",text:"link text"}),new Wysiwym.Button("Quote",Wysiwym.span,{prefix:"[quote]",suffix:"[/quote]",text:"quote text"}),new Wysiwym.Button("Code",Wysiwym.span,{prefix:"[code]",suffix:"[/code]",text:"code text"})];this.help=[{label:"Bold",syntax:"[b]bold[/b]"},{label:"Italic",syntax:"[i]italics[/i]"},{label:"Link",syntax:'[url="http://example.com"]pk![/url]'},{label:"Blockquote",syntax:"[quote]quote text[/quote]"},{label:"Large Code Block",syntax:"[code]code text[/code]"}]};String.prototype.strip=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.lstrip=function(){return this.replace(/^\s+/,"")};String.prototype.rstrip=function(){return this.replace(/\s+$/,"")};String.prototype.startswith=function(a){return this.substring(0,a.length)==a};String.prototype.endswith=function(a){return this.substring(a.length,this.length)==a};

/*
Name: showdown.js A javascript port of Markdown.
By: Copyright (c) 2007 John Fraser
Web Site: (http://www.attacklab.net/)
Licence: Redistributable Under The BSD Licence 
(http://www.opensource.org/licenses/bsd-license.php)
*/

var Showdown={};Showdown.converter=function(){var a;var j;var A;var i=0;this.makeHtml=function(H){a=new Array();j=new Array();A=new Array();H=H.replace(/~/g,"~T");H=H.replace(/\$/g,"~D");H=H.replace(/\r\n/g,"\n");H=H.replace(/\r/g,"\n");H="\n\n"+H+"\n\n";H=z(H);H=H.replace(/^[ \t]+$/mg,"");H=m(H);H=d(H);H=G(H);H=q(H);H=H.replace(/~D/g,"$$");H=H.replace(/~T/g,"~");return H};var d=function(H){var H=H.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|\Z)/gm,function(K,M,L,J,I){M=M.toLowerCase();a[M]=h(L);if(J){return J+I}else{if(I){j[M]=I.replace(/"/g,"&quot;")}}return""});return H};var m=function(J){J=J.replace(/\n/g,"\n\n");var I="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del";var H="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math";J=J.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,x);J=J.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,x);J=J.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,x);J=J.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g,x);J=J.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,x);J=J.replace(/\n\n/g,"\n");return J};var x=function(H,I){var J=I;J=J.replace(/\n\n/g,"\n");J=J.replace(/^\n/,"");J=J.replace(/\n+$/g,"");J="\n\n~K"+(A.push(J)-1)+"K\n\n";return J};var G=function(I){I=f(I);var H=o("<hr />");I=I.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,H);I=I.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm,H);I=I.replace(/^[ ]{0,2}([ ]?\_[ ]?){3,}[ \t]*$/gm,H);I=E(I);I=b(I);I=u(I);I=m(I);I=g(I);return I};var r=function(H){H=C(H);H=l(H);H=e(H);H=F(H);H=y(H);H=n(H);H=h(H);H=c(H);H=H.replace(/  +\n/g," <br />\n");return H};var l=function(I){var H=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi;I=I.replace(H,function(K){var J=K.replace(/(.)<\/?code>(?=.)/g,"$1`");J=w(J,"\\`*_");return J});return I};var y=function(H){H=H.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,D);H=H.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?(.*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,D);H=H.replace(/(\[([^\[\]]+)\])()()()()()/g,D);return H};var D=function(N,T,S,R,Q,P,M,L){if(L==undefined){L=""}var K=T;var I=S;var J=R.toLowerCase();var H=Q;var O=L;if(H==""){if(J==""){J=I.toLowerCase().replace(/ ?\n/g," ")}H="#"+J;if(a[J]!=undefined){H=a[J];if(j[J]!=undefined){O=j[J]}}else{if(K.search(/\(\s*\)$/m)>-1){H=""}else{return K}}}H=w(H,"*_");var U='<a href="'+H+'"';if(O!="")%7bO%3dO.replace(/index.html"/g,"&quot;");O=w(O,"*_");U+=' title="'+O+'"'}U+=">"+I+"</a>";return U};var F=function(H){H=H.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,t);H=H.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,t);return H};var t=function(N,T,S,R,Q,P,M,L){var K=T;var J=S;var I=R.toLowerCase();var H=Q;var O=L;if(!O){O=""}if(H==""){if(I==""){I=J.toLowerCase().replace(/ ?\n/g," ")}H="#"+I;if(a[I]!=undefined){H=a[I];if(j[I]!=undefined){O=j[I]}}else{return K}}J=J.replace(/"/g,"&quot;");H=w(H,"*_");var U='<img src="'+H+'" alt="'+J+'"';O=O.replace(/"/g,"&quot;");O=w(O,"*_");U+=' title="'+O+'"';U+=" />";return U};var f=function(H){H=H.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(I,J){return o("<h1>"+r(J)+"</h1>")});H=H.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(J,I){return o("<h2>"+r(I)+"</h2>")});H=H.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(I,L,K){var J=L.length;return o("<h"+J+">"+r(K)+"</h"+J+">")});return H};var p;var E=function(I){I+="~0";var H=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;if(i){I=I.replace(H,function(K,N,M){var O=N;var L=(M.search(/[*+-]/g)>-1)?"ul":"ol";O=O.replace(/\n{2,}/g,"\n\n\n");var J=p(O);J=J.replace(/\s+$/,"");J="<"+L+">"+J+"</"+L+">\n";return J})}else{H=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g;I=I.replace(H,function(L,P,N,K){var O=P;var Q=N;var M=(K.search(/[*+-]/g)>-1)?"ul":"ol";var Q=Q.replace(/\n{2,}/g,"\n\n\n");var J=p(Q);J=O+"<"+M+">\n"+J+"</"+M+">\n";return J})}I=I.replace(/~0/,"");return I};p=function(H){i++;H=H.replace(/\n{2,}$/,"\n");H+="~0";H=H.replace(/(\n)?(^[ \t]*)([*+-]|\d+[.])[ \t]+([^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+-]|\d+[.])[ \t]+))/gm,function(K,M,L,J,I){var O=I;var N=M;var P=L;if(N||(O.search(/\n{2,}/)>-1)){O=G(s(O))}else{O=E(s(O));O=O.replace(/\n$/,"");O=r(O)}return"<li>"+O+"</li>\n"});H=H.replace(/~0/g,"");i--;return H};var b=function(H){H+="~0";H=H.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(I,K,J){var L=K;var M=J;L=v(s(L));L=z(L);L=L.replace(/^\n+/g,"");L=L.replace(/\n+$/g,"");L="<pre><code>"+L+"\n</code></pre>";return o(L)+M});H=H.replace(/~0/,"");return H};var o=function(H){H=H.replace(/(^\n+|\n+$)/g,"");return"\n\n~K"+(A.push(H)-1)+"K\n\n"};var C=function(H){H=H.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(K,M,L,J,I){var N=J;N=N.replace(/^([ \t]*)/g,"");N=N.replace(/[ \t]*$/g,"");N=v(N);return M+"<code>"+N+"</code>"});return H};var v=function(H){H=H.replace(/&/g,"&amp;");H=H.replace(/</g,"&lt;");H=H.replace(/>/g,"&gt;");H=w(H,"*_{}[]\\",false);return H};var c=function(H){H=H.replace(/(\*\*|__)(?=\S)([^\r]*?\S[*_]*)\1/g,"<strong>$2</strong>");H=H.replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>");return H};var u=function(H){H=H.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(I,J){var K=J;K=K.replace(/^[ \t]*>[ \t]?/gm,"~0");K=K.replace(/~0/g,"");K=K.replace(/^[ \t]+$/gm,"");K=G(K);K=K.replace(/(^|\n)/g,"$1  ");K=K.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(L,M){var N=M;N=N.replace(/^  /mg,"~0");N=N.replace(/~0/g,"");return N});return o("<blockquote>\n"+K+"\n</blockquote>")});return H};var g=function(N){N=N.replace(/^\n+/g,"");N=N.replace(/\n+$/g,"");var M=N.split(/\n{2,}/g);var J=new Array();var H=M.length;for(var I=0;I<H;I++){var L=M[I];if(L.search(/~K(\d+)K/g)>=0){J.push(L)}else{if(L.search(/\S/)>=0){L=r(L);L=L.replace(/^([ \t]*)/g,"<p>");L+="</p>";J.push(L)}}}H=J.length;for(var I=0;I<H;I++){while(J[I].search(/~K(\d+)K/)>=0){var K=A[RegExp.$1];K=K.replace(/\$/g,"$$$$");J[I]=J[I].replace(/~K\d+K/,K)}}return J.join("\n\n")};var h=function(H){H=H.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;");H=H.replace(/<(?![a-z\/?\$!])/gi,"&lt;");return H};var e=function(H){H=H.replace(/\\(\\)/g,k);H=H.replace(/\\([`*_{}\[\]()>#+-.!])/g,k);return H};var n=function(H){H=H.replace(/<((https?|ftp|dict):[^'">\s]+)>/gi,'<a href="$1">$1</a>');H=H.replace(/<(?:mailto:)?([-.\w]+\@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,function(I,J){return B(q(J))});return H};var B=function(J){function I(L){var K="0123456789ABCDEF";var M=L.charCodeAt(0);return(K.charAt(M>>4)+K.charAt(M&15))}var H=[function(K){return"&#"+K.charCodeAt(0)+";"},function(K){return"&#x"+I(K)+";"},function(K){return K}];J="mailto:"+J;J=J.replace(/./g,function(K){if(K=="@"){K=H[Math.floor(Math.random()*2)](K)}else{if(K!=":"){var L=Math.random();K=(L>0.9?H[2](K):L>0.45?H[1](K):H[0](K))}}return K});J='<a href="'+J+'">'+J+"</a>";J=J.replace(/">.+:/g,'">');return J};var q=function(H){H=H.replace(/~E(\d+)E/g,function(I,K){var J=parseInt(K);return String.fromCharCode(J)});return H};var s=function(H){H=H.replace(/^(\t|[ ]{1,4})/gm,"~0");H=H.replace(/~0/g,"");return H};var z=function(H){H=H.replace(/\t(?=\t)/g,"    ");H=H.replace(/\t/g,"~A~B");H=H.replace(/~B(.+?)~A/g,function(I,L,K){var N=L;var J=4-N.length%4;for(var M=0;M<J;M++){N+=" "}return N});H=H.replace(/~A/g,"    ");H=H.replace(/~B/g,"");return H};var w=function(L,I,J){var H="(["+I.replace(/([\[\]\\])/g,"\\$1")+"])";if(J){H="\\\\"+H}var K=new RegExp(H,"g");L=L.replace(K,k);return L};var k=function(H,J){var I=J.charCodeAt(0);return"~E"+I+"E"}};